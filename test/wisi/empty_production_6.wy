;;; finding bug in parse table generator; nonterm followed by possibly empty nonterm
;;
;; also testing pending actions during conflict resolution; label_opt
;; action is not output until one parser terminates.

%{
%}

%token <punctuation> COLON ":"
%token <punctuation> COLON_EQUAL ":="
%token <punctuation> SEMICOLON ";"

%keyword BEGIN "begin"
%keyword END "end"

%token <symbol> IDENTIFIER "[a-zA-Z][0-9a-zA-Z_]*"

%start compilation_unit
%parser_algorithm LALR
%output_language Elisp

%conflict SHIFT/REDUCE in state compilation_unit, compilation_unit  on token IDENTIFIER
%conflict SHIFT/REDUCE in state sequence_of_statements, sequence_of_statements  on token IDENTIFIER

%%

compilation_unit
  : BEGIN sequence_of_statements END SEMICOLON
    (setq wisi-test-success t)
  ;

statement
  : label_opt IDENTIFIER COLON_EQUAL IDENTIFIER SEMICOLON
  ;

sequence_of_statements
  : statement ;; label is included in statement
  | sequence_of_statements statement
  ;

label_opt
  : ;; empty
  | IDENTIFIER COLON ;; on blocks, loops
    (wisi-statement-action [1 statement-start])
  ;

%%
;;; end of file
