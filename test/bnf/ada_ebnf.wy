;; Examples of EBNF syntax used in the ada_annex_p grammar file
;; ../../org.emacs.ada/ada_annex_p.wy
;;
;; Also syntax that revealed bugs discovered during development.
;;
;; We are testing the translation from EBNF to BNF, and mapping the
;; tokens to actions.
%meta_syntax EBNF

%generate LALR Ada_Emacs re2c Process

%start compilation_unit

%token <punctuation> COLON ":"
%token <punctuation> COLON_EQUAL ":="
%token <punctuation> SEMICOLON ";"
%token <punctuation> TICK "'"

%token <symbol> IDENTIFIER %[ [a-zA-Z\x80-\U0010FFFF][0-9a-zA-Z_\x80-\U0010FFFF]* ]%

%conflict SHIFT assign_value | REDUCE subtype_indication on token COLON_EQUAL
%conflict SHIFT subtype_declaration | REDUCE subtype_indication on token SEMICOLON
%conflict SHIFT object_declaration | REDUCE subtype_indication on token SEMICOLON

assign_value : ':=' expression ;

generic_formal_part ::= 'generic' {generic_formal_parameter_declaration | use_clause} ;

subtype_declaration
  : 'subtype' IDENTIFIER 'is' typename=(name | subtype_indication) ';'
  ;

object_declaration
  : IDENTIFIER ':' ['constant'] (name | subtype_indication) [assign_value] ';'
    %((wisi-statement-action [1 statement-start 6 statement-end])
      (wisi-indent-action [nil ada-indent-broken ada-indent-broken
                               (wisi-hanging* ada-indent-broken ada-indent-broken)
                               (wisi-hanging% (wisi-anchored% 5 ada-indent-broken)
                                              (wisi-anchored% 5 (* 2 ada-indent-broken)))
                               ada-indent-broken]))%
  ;

compilation_unit
  : generic_formal_part
  | subtype_declaration
  | object_declaration
  ;

;; Stubs
constraint : 'range' IDENTIFIER TICK IDENTIFIER ;

generic_formal_parameter_declaration : name ';' ;

use_clause : 'use' name ';' ;

subtype_indication
  : name constraint
  | name
  ;

name : IDENTIFIER ;

expression : IDENTIFIER ;

;; end of file
