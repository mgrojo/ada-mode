;; Grammar has no conflicts; test wisi cache actions

%{
%}

%keyword FUNCTION "function"
%keyword LEFT_PAREN "("
%keyword PROCEDURE "procedure"
%keyword RIGHT_PAREN ")"

%token <symbol> SYMBOL "[a-zA-Z][0-9a-zA-Z_]*"

;; need whitespace for Aflex lexer
%token <whitespace> WHITESPACE "[ \t\n]"
%token <line_comment> COMMENT "\-\-[^\n]*\n"

;; 'fasttoken_accept', Wisi_EOI added in wisi-generate
%start compilation_unit
%parser_algorithm LALR_LR1
%output_language Ada
%lexer Aflex

%%

compilation_unit
  : declarations
    (null; -- setq wisi-test-success t)
  ;

declarations
  : declaration
  | declarations declaration
  ;

declaration
  : subprogram
  ;

subprogram
  : FUNCTION parameter_list SYMBOL
    (null; -- wisi-statement-action [1 function 2 other]) ;; overwrites open-paren, but not close-paren
  | PROCEDURE parameter_list SYMBOL
    (null; -- wisi-statement-action [1 procedure 2 other]) ;; ignored if parameter_list is empty
  ;

;; not on one line, empty production with comment
parameter_list
  : LEFT_PAREN RIGHT_PAREN ;; c-like no parameters
    (null; -- wisi-statement-action [1 open-paren 2 close-paren])
  | ;; ada-like no parameters
  | LEFT_PAREN SYMBOL RIGHT_PAREN
    (null; -- wisi-statement-action [1 open-paren 3 close-paren])
  ;

%%

;; end of file
