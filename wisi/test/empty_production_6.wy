;;; finding bug in parse table generator; nonterm followed by possibly empty nonterm
;;
;; also testing pending actions during conflict resolution; label_opt
;; action is not output until one parser terminates.

%{
%}

%token <punctuation> COLON ":"
%token <punctuation> COLON_EQUAL ":="
%token <punctuation> SEMICOLON ";"

%keyword BEGIN "begin"
%keyword END "end"

%token <symbol> IDENTIFIER [a-zA-Z][0-9a-zA-Z_]*

%token <whitespace> WHITESPACE [ \t\n]

%start compilation_unit
%first_state_index 1
%first_parser_label 1
%parser_algorithm LALR_LR1
%output_language Ada
%lexer re2c

%conflict SHIFT/REDUCE in state label_opt, label_opt on token IDENTIFIER

%%

compilation_unit
  : BEGIN sequence_of_statements END SEMICOLON
    (null; -- setq wisi-test-success t)
  ;

statement
  : label_opt IDENTIFIER COLON_EQUAL IDENTIFIER SEMICOLON
  ;

sequence_of_statements
  : statement ;; label is included in statement
  | sequence_of_statements statement
  ;

label_opt
  : ;; empty
  | IDENTIFIER COLON ;; on blocks, loops
    (null; -- wisi-statement-action [1 block-start])
  ;

%%
;;; end of file
