-- Common settings
project Common is

   for Source_Dirs use (); -- avoids spurious error about "no Ada sources"

   type Build_Type is ("Developer", "User");

   Build : Build_Type := External ("BUILD", "User");

   type Lib_Type is ("static", "dynamic");

   Libtype : Lib_Type := External ("LIBTYPE", "dynamic");

   Dyn_Lib_Extension := External ("DYN_LIB_EXTENSION", "so");

   package Compiler is
      -- Switches for gcc

      -- Files generated by wisi may have longer lines
      Style_Checks_No_Length := "-gnaty3abcefhiklnOprtx";
      Style_Checks := Style_Checks_No_Length & "M120";

      --  -gnatVa causes some inline procedures to be non-inlineable;
      --  suppress that warning with -gnatwP.
      Debug_Switches :=
        --  Switches we always use
        ("-g",
         "-O0",
         "-gnat2012",
         "-gnatfoqQ",
         "-gnatVa",
         "-gnatwaeLP",
         "-fstack-check");

      --  AdaCore recommends -O2 -gnatn instead of -O3; -O3 includes
      --  "potentially unsafe and disruptive optimizations". We include
      --  -fstack-check because it catches hard-to-find bugs, and the
      --  processors are so fast.
      Release_Switches :=
        ("-g",
         "-O2",
         "-gnat2012",
         "-gnatfnoqQ",
         "-gnatwaeL",
         "-fstack-check");

      --  The project file syntax does not let us set a variable in a
      --  case statement. So we set the Default_Switches attribute to
      --  contain the external-dependent switches. This is then
      --  accessible in child project files via 'Default_Switches.

      case Build is
         when "Developer" =>
            -- -gnatyO requires patching the compiler runtime source for GNAT 6.x and earlier
            -- It is not valid for GNAT 4.x and earlier
            for Default_Switches ("Ada") use ("-gnatyO");

         when "User" =>
            null;
      end case;

   end Compiler;

   --  In user project files, normally use this:
   --  package Compiler is
   --  for Default_Switches ("Ada") use
   --     Standard_Common.Compiler.Release_Switches &
   --     Standard_Common.Compiler.Style_Checks &
   --     Standard_Common.Compiler'Default_Switches ("Ada");
   --  end Compiler;

   package Builder is
      --  Switches for gnatmake
      for Default_Switches ("Ada") use ("-C");
   end Builder;

   --  In user project files, normally use this:
   --  package Builder is
   --     for Default_Switches ("Ada") use Standard_Common.Builder'Default_Switches ("Ada");
   --  end Builder;

   package Binder is
      --  Switches for gnatbind
      for Default_Switches ("Ada") use ("-E");
   end Binder;

   --  In user project files, normally use this:
   --  package Binder is
   --     for Default_Switches ("Ada") use Standard_Common.Binder'Default_Switches ("Ada");
   --  end Binder;

end Common;
