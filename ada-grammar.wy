;;; Wisent grammar for Ada
;;
;; Copyright (C) 2012 Free Software Foundation, Inc.
;;
;; Author: Stephen Leake <stephe-leake@stephe-leake.org>
;; Maintainer: Stephen Leake <stephe-leake@stephe-leake.org>
;; Created: Sept 2012
;; Keywords: syntax
;;
;; This file is part of GNU Emacs.
;;
;; GNU Emacs is free software: you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.
;;
;; GNU Emacs is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.
;;
;; You should have received a copy of the GNU General Public License
;; along with GNU Emacs.  If not, see <http://www.gnu.org/licenses/>.
;;
;;; Commentary:
;;
;; This is a Wisent grammar file Ada. It is derived from the Ada
;; Reference Manual (ARM), which is available as (info "(aarm2012)")
;; or at http://www.ada-auth.org/standards/ada12.html under the
;; license in ada_license.text.
;;
;; "wisent" is the European bison
;; (http://en.wikipedia.org/wiki/Wisent); the 'wisent' parser
;; generator is the Gnu parser generator implemented in Emacs elisp.
;; The input file syntax is the same as Gnu bison
;; (http://www.gnu.org/software/bison/manual/), with some additions
;; (apparently not documented anywhere). There is a semantic mailing
;; list at https://lists.sourceforge.net/lists/listinfo/cedet-semantic

%{
(require 'wisi)
%}

;; Declarations

;; token declarations

;; Ada keywords (ARM 2.9) and operators (info "(aarm2012)2.9" "*info AARM*")

%keyword ABS "abs"
%keyword ABSTRACT "abstract"
%keyword ACCESS "access"
%keyword ALIASED "aliased"
%keyword ALL "all"
%keyword AND "and"
%keyword ARRAY "array"
%keyword BEGIN "begin"
%keyword BODY "body"
%keyword CASE "case"
%keyword CONSTANT "constant"
%keyword DECLARE "declare"
%keyword DELTA "delta"
%keyword DIGITS "digits"
%keyword ELSE "else"
%keyword ELSIF "elsif"
%keyword END "end"
%keyword ENTRY "entry"
%keyword EXCEPTION "exception"
%keyword FUNCTION "function"
%keyword GENERIC "generic"
%keyword IF "if"
%keyword IN "in"
%keyword INTERFACE "interface"
%keyword IS "is"
%keyword LEFT_PAREN "("
%keyword LIMITED "limited"
%keyword MOD "mod"
%keyword NEW "new"
%keyword NOT "not"
%keyword NULL "null"
%keyword OF "of"
%keyword OR "or"
%keyword OTHERS "others"
%keyword OUT "out"
%keyword OVERRIDING "overriding"
%keyword PACKAGE "package"
%keyword PRAGMA "pragma"
%keyword PRIVATE "private"
%keyword PROCEDURE "procedure"
%keyword PROTECTED "protected"
%keyword RANGE "range"
%keyword RENAMES "renames"
%keyword RECORD "record"
%keyword REM "rem"
%keyword RETURN "return"
%keyword RIGHT_PAREN ")"
%keyword SEPARATE "separate"
%keyword SUBTYPE "subtype"
%keyword SYNCHRONIZED "synchronized"
%keyword TAGGED "tagged"
%keyword TASK "task"
%keyword THEN "then"
%keyword TYPE "type"
%keyword USE "use"
%keyword WHEN "when"
%keyword WITH "with"
%keyword XOR "xor"

;; all tokens that consist of characters with punctuation syntax
%token <punctuation> AMPERSAND "&"
%token <punctuation> BAR "|"
%token <punctuation> BOX "<>"
%token <punctuation> COLON ":"
%token <punctuation> COLON_EQUAL ":="
%token <punctuation> COMMA ","
%token <punctuation> DOT "."
%token <punctuation> DOT_DOT ".."
%token <punctuation> EQUAL "="
%token <punctuation> EQUAL_GREATER "=>"
%token <punctuation> GREATER ">"
%token <punctuation> GREATER_EQUAL ">="
%token <punctuation> LESS "<"
%token <punctuation> LESS_EQUAL "<="
%token <punctuation> MINUS "-"
%token <punctuation> PLUS "+"
%token <punctuation> SEMICOLON ";"
%token <punctuation> SLASH "/"
%token <punctuation> SLASH_EQUAL "/="
%token <punctuation> STAR "*"
%token <punctuation> STAR_STAR "**"
%token <punctuation> TICK "'"

%token <symbol> IDENTIFIER
%token <string> STRING_LITERAL
%token <character_literal> CHARACTER_LITERAL
%token <numeric_literal> NUMERIC_LITERAL
;; FIXME: wisi lexer treats numeric_literal as identifier; fix that or delete this
;; FIXME: wisi lexer treats character_literal as ?; fix that or delete this

%start compilation_unit

;; known conflicts that are resolved by generalized LALR parser
%conflict REDUCE/REDUCE in state identifier_list, name on token COMMA
%conflict REDUCE/SHIFT in state subprogram_specification, generic_instantiation on token IS
%conflict REDUCE/SHIFT in state subprogram_specification, generic_instantiation on token IS
%conflict REDUCE/SHIFT in state generic_formal_part, generic_renaming_declaration on token PACKAGE
%conflict REDUCE/SHIFT in state generic_formal_part, generic_renaming_declaration on token PROCEDURE
%conflict REDUCE/SHIFT in state generic_formal_part, generic_renaming_declaration on token FUNCTION
%conflict REDUCE/SHIFT in state association, qualified_expression on token RIGHT_PAREN
%conflict REDUCE/REDUCE in state choice_relation, relation on token XOR
%conflict REDUCE/REDUCE in state choice_relation, relation on token OR
%conflict REDUCE/REDUCE in state choice_relation, relation on token AND
%conflict REDUCE/REDUCE in state choice_relation, relation on token XOR
%conflict REDUCE/REDUCE in state choice_relation, relation on token OR
%conflict REDUCE/REDUCE in state choice_relation, relation on token AND
%conflict SHIFT/REDUCE in state primary, association on token RIGHT_PAREN
%%
;;;; grammar rules
;;
;; The actions cache information in keywords that are significant for
;; indentation and motion.
;;
;; BNF copied from:
;;
;; (info "(aarm2012)Annex P" "*info Annex P*")
;; file:///C:/Projects/arm_info/org.adaic.arm_form/build/html/aarm2012/AA-P.html
;;
;; but listed in alphabetical order. Repeating constructs are
;; implemented with extra productions. Optional constructs are
;; implemented by repeated productions. Most names are simplified to
;; just "name".
;;
;; BNF not copied until part of it is encountered in a test,
;; part not needed left commented out.

access_definition
  : NOT NULL ACCESS CONSTANT name
    (wisi-statement-action 5 'type);; for font-lock - see ada-wisi-setup
  | ACCESS CONSTANT name
    (wisi-statement-action 3 'type)
  | ACCESS name
    (wisi-statement-action 2 'type)
  | NOT NULL ACCESS PROTECTED PROCEDURE parameter_profile
  | NOT NULL ACCESS PROCEDURE parameter_profile
  | NOT NULL ACCESS PROTECTED FUNCTION parameter_and_result_profile
  | NOT NULL ACCESS FUNCTION parameter_and_result_profile
  ;

access_type_definition
  : NOT NULL ACCESS general_access_modifier subtype_indication
  | ACCESS subtype_indication ;; access_to_object_definition
  | NOT NULL ACCESS PROTECTED PROCEDURE parameter_profile;; access_to_subprogram_definition
  | NOT NULL ACCESS PROCEDURE parameter_profile
  | NOT NULL ACCESS PROTECTED FUNCTION  parameter_and_result_profile
  | NOT NULL ACCESS FUNCTION  parameter_and_result_profile
  | ACCESS PROTECTED PROCEDURE parameter_profile
  | ACCESS PROCEDURE parameter_profile
  | ACCESS PROTECTED FUNCTION  parameter_and_result_profile
  | ACCESS FUNCTION  parameter_and_result_profile
  ;

actual_parameter_part
  : LEFT_PAREN association_list RIGHT_PAREN
    (wisi-statement-action 1 'open-paren 3 'close-paren)
  ;

aggregate
  : LEFT_PAREN association_list RIGHT_PAREN ;; record_aggregate, named_array_aggregate, positional_array_aggregate
    (wisi-statement-action 1 'open-paren 3 'close-paren)
  | LEFT_PAREN expression WITH association_list RIGHT_PAREN ;; extension_aggregate
    (wisi-statement-action 1 'open-paren 5 'close-paren)
  ;

array_type_definition
  : ARRAY LEFT_PAREN index_subtype_definition_list RIGHT_PAREN OF component_definition
 ;; unconstrained_array_definition
  | ARRAY LEFT_PAREN discrete_subtype_definition_list RIGHT_PAREN OF component_definition
 ;; constrained_array_definition
  ;

assignment_statement
  : name COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
 ;; FIXME: name can be a function call with params, which needs wisi-start-action for parens?
  ;

association
  : CHARACTER_LITERAL EQUAL_GREATER expression ;; part of selector_name that does not overlap name
  | CHARACTER_LITERAL EQUAL_GREATER BOX ;; from formal_package_association_list
  | discrete_choice_list EQUAL_GREATER expression
  | discrete_choice_list EQUAL_GREATER BOX
  | expression
  ;

association_list
  : association
  | association_list COMMA association
    (wisi-statement-action 2 'list-break)
  ;

attribute_reference : name TICK attribute_designator ;

attribute_designator
 ;; : IDENTIFIER LEFT_PAREN expression RIGHT_PAREN
 ;; causes shift/reduce conflict with something; covered by name =>
 ;; function_call => name'identifier actual_parameter_part?
  : IDENTIFIER
  | ACCESS
  | DELTA
  | DIGITS
  | MOD
  ;

;; basic_declarative_item merged into declaration
;; basic_declaration merged into declaration

binary_adding_operator : PLUS | MINUS | AMPERSAND ; ;; + | - | &

block_statement
  : IDENTIFIER COLON DECLARE declarations BEGIN handled_sequence_of_statements END IDENTIFIER SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-middle 7 'block-end 9 'statement-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 6))
  | IDENTIFIER COLON DECLARE declarations BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-middle 7 'block-end 8 'statement-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 6))
  | IDENTIFIER COLON BEGIN handled_sequence_of_statements END IDENTIFIER SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-end 7 'statement-end)
      (wisi-start-action 1 4))
  | IDENTIFIER COLON BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-end 6 'statement-end)
      (wisi-start-action 1 4))
  | DECLARE declarations BEGIN handled_sequence_of_statements END IDENTIFIER SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-end 7 'statement-end)
      (wisi-start-action 1 2)
      (wisi-start-action 1 4))
  | DECLARE declarations BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-end 6 'statement-end)
      (wisi-start-action 1 2)
      (wisi-start-action 1 4))
  | BEGIN handled_sequence_of_statements END IDENTIFIER SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-end 5 'statement-end)
      (wisi-start-action 1 2))
  | BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-end 4 'statement-end)
      (wisi-start-action 1 2))
  ;

body
  : proper_body
  | body_stub
  ;

body_stub : subprogram_body_stub | package_body_stub | task_body_stub | protected_body_stub ;

case_expression
  : CASE expression IS case_expression_alternative_list
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle)
      (wisi-start-action 1 4))
  ;

case_expression_alternative
  : WHEN discrete_choice_list EQUAL_GREATER expression
    (wisi-statement-action 1 'block-middle 3 'statement-other)
  ;

case_expression_alternative_list
  : case_expression_alternative
  | case_expression_alternative_list COMMA case_expression_alternative
    (wisi-statement-action 2 'statement-other)
  ;

choice_expression
  : choice_relation
  | choice_relation_and_list
  | choice_relation_or_list
  | choice_relation_xor_list
  | choice_relation_and_then_list
  | choice_relation_or_else_list
  ;

choice_relation_and_list
  : choice_relation AND choice_relation
  | choice_relation_and_list AND choice_relation
  ;

choice_relation_or_list
  : choice_relation OR choice_relation
  | choice_relation_or_list OR choice_relation
  ;

choice_relation_xor_list
  : choice_relation XOR choice_relation
  | choice_relation_xor_list XOR choice_relation
  ;

choice_relation_and_then_list
  : choice_relation AND THEN choice_relation
  | choice_relation_and_then_list AND THEN choice_relation
  ;

choice_relation_or_else_list
  : choice_relation OR ELSE choice_relation
  | choice_relation_or_else_list OR ELSE choice_relation
  ;

choice_relation
  : simple_expression relational_operator simple_expression
  | simple_expression
  ;

compilation_unit
  : context_clause library_item
  | library_item
 ;;  | context_clause subunit
  ;

component_declaration
 ;; leaving out [aspect_specification]
  : identifier_list COLON component_definition COLON_EQUAL expression SEMICOLON
  | identifier_list COLON component_definition SEMICOLON
  ;

component_definition
  : ALIASED subtype_indication
  | subtype_indication
  | ALIASED access_definition
  | access_definition
  ;

component_item
  : component_declaration
 ;;  | aspect_clause
  ;

component_list
  : component_item
  | component_list component_item
  | component_list variant_part
  | NULL SEMICOLON
  ;

compound_statement
  : if_statement
  ;; | case_statement
  ;; | loop_statement
  | block_statement
  ;; | extended_return_statement
  ;; | accept_statement
  ;; | select_statement
  ;

constraint
  : RANGE range ;; range_constraint
  ;; | digits_constraint
  ;; | delta_constraint
  ;; | index_constraint
  ;; | discriminant_constraint
  ;

context_clause
  : context_item
  | context_clause context_item
  ;

context_item : pragma | with_clause | use_clause;

;; direct_name replaced by selector_name

declaration
  ;; | abstract_subprogram_declaration
  ;; | aspect_clause
  : body
  | entry_declaration
  | exception_declaration
  ;; | expression_function_declaration
  | generic_declaration
  | generic_instantiation
  ;; | null_procedure_declaration
  | identifier_list COLON CONSTANT COLON_EQUAL expression SEMICOLON ;; number_declaration
  | object_declaration
  | package_declaration
  | pragma ;; not a 'declaration' in ARM, but it must be in the grammar
  | renaming_declaration
  | subprogram_declaration
  | subtype_declaration
  | type_declaration
  ;; | use_clause
  ;

declarations
  : declaration
 ;; include null declarations wherever 'declarations' occurs
  | declarations declaration
  ;

;; declarative_part replaced by declarations
;; declarative_item merged into declaration

derived_type_definition
  : ABSTRACT LIMITED NEW name AND interface_list WITH record_definition
  | ABSTRACT LIMITED NEW name WITH record_definition
  | ABSTRACT LIMITED NEW name
  | ABSTRACT NEW name
  | NEW name
  ;

discrete_choice_list
  : discrete_choice
  | discrete_choice_list BAR discrete_choice
  ;

discrete_choice
  : choice_expression
 ;; | subtype_indication
 ;; FIXME: causes reduce/reduce conflict because both
 ;; choice_expression and subtype_indication can be just 'name'
  | range
  | OTHERS
  ;

discrete_subtype_definition : subtype_indication | range ;

discrete_subtype_definition_list
  : discrete_subtype_definition
  | discrete_subtype_definition_list COMMA discrete_subtype_definition
    (wisi-statement-action 2 'list-break)
  ;

discriminant_part
  : LEFT_PAREN BOX RIGHT_PAREN ;; (<>) unknown_discriminant_part
  | LEFT_PAREN discriminant_specification_list RIGHT_PAREN;; known_discriminant_part
    (wisi-statement-action 1 'open-paren 3 'close-paren)
  ;

discriminant_specification
  : identifier_list COLON NOT NULL name COLON_EQUAL expression
  | identifier_list COLON NOT NULL name
  | identifier_list COLON name
  | identifier_list COLON access_definition COLON_EQUAL expression
  | identifier_list COLON access_definition
  ;

discriminant_specification_list
  : discriminant_specification
  | discriminant_specification_list SEMICOLON discriminant_specification
    (wisi-statement-action 2 'list-break)
  ;

elsif_expression_item
  : ELSIF expression THEN expression
    (wisi-statement-action 1 'block-middle 3 'block-middle)
  ;

elsif_expression_list
  : elsif_expression_item
  | elsif_expression_list elsif_expression_item
  ;

elsif_statement_item
  : ELSIF expression THEN expression
    (progn
      (wisi-statement-action 1 'block-middle 3 'block-middle)
      (wisi-motion-action 1 3))
  ;

elsif_statement_list
  : elsif_statement_item
  | elsif_statement_list elsif_statement_item
  ;

;; leaving out [aspect_specification]
entry_declaration
  : overriding_indicator ENTRY IDENTIFIER LEFT_PAREN discrete_subtype_definition RIGHT_PAREN
    parameter_profile SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'open-paren 6 'close-paren 8 'statement-end)
  | overriding_indicator ENTRY IDENTIFIER parameter_profile SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | ENTRY IDENTIFIER parameter_profile SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  | ENTRY IDENTIFIER LEFT_PAREN discrete_subtype_definition RIGHT_PAREN parameter_profile SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'open-paren 5 'close-paren 7 'statement-end)
  ;

enumeration_type_definition
  : LEFT_PAREN enumeration_literal_list RIGHT_PAREN
    (wisi-statement-action 1 'open-paren 3 'close-paren)
  ;

enumeration_literal ;; enumeration_literal_specification
  : IDENTIFIER
  | CHARACTER_LITERAL
  ;

enumeration_literal_list
  : enumeration_literal
  | enumeration_literal COMMA enumeration_literal
  ;

exception_choice : name | OTHERS ;

exception_choice_list
  : exception_choice
  | exception_choice_list BAR exception_choice
  ;

;; leaving out [aspect_specification]
exception_declaration
  : identifier_list COLON EXCEPTION SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  ;

exception_handler
  : WHEN IDENTIFIER COLON exception_choice_list EQUAL_GREATER sequence_of_statements
    (progn
      (wisi-statement-action 1 'block-middle)
      (wisi-start-action 1 6))
  | WHEN exception_choice_list EQUAL_GREATER sequence_of_statements
    (progn
      (wisi-statement-action 1 'block-middle)
      (wisi-start-action 1 4))
  ;

exception_handler_list
  : exception_handler
  | exception_handler_list exception_handler
  ;

expression
  : relation
  | relation_and_list
  | relation_and_then_list
  | relation_or_list
  | relation_or_else_list
  | relation_xor_list
  ;

;; designator is merged with name

factor
  : primary STAR_STAR primary
  | primary
  | ABS primary
  | NOT primary
  ;

formal_object_declaration
 ;; leaving out [aspect_specification]
  : identifier_list COLON mode NOT NULL name COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 9 'statement-end)
  | identifier_list COLON mode name COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 7 'statement-end)
  | identifier_list COLON mode NOT NULL name SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | identifier_list COLON mode name SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | identifier_list COLON mode access_definition COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 7 'statement-end)
  | identifier_list COLON mode access_definition SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  ;

formal_part
  : LEFT_PAREN parameter_specification_list RIGHT_PAREN
    (wisi-statement-action 1 'open-paren 3 'close-paren)
  ;

;; leaving out [aspect_specification]
formal_subprogram_declaration
  : WITH subprogram_specification IS subprogram_default SEMICOLON ;; formal_concrete_subprogram_declaration
    (progn
      (wisi-statement-action 1 'statement-start 5 'statement-end)
      (wisi-start-action 1 2))
  | WITH subprogram_specification SEMICOLON ;; formal_concrete_subprogram_declaration
    (progn
      (wisi-statement-action 1 'statement-start 3 'statement-end)
      (wisi-start-action 1 2))
  | WITH subprogram_specification IS ABSTRACT subprogram_default SEMICOLON ;; formal_abstract_subprogram_declaration
    (progn
      (wisi-statement-action 1 'statement-start 6 'statement-end)
      (wisi-start-action 1 2))
  | WITH subprogram_specification IS ABSTRACT SEMICOLON ;; formal_abstract_subprogram_declaration
    (progn
      (wisi-statement-action 1 'statement-start 5 'statement-end)
      (wisi-start-action 1 2))
  ;

;; leaving out [aspect_specification]
formal_type_declaration
  : TYPE IDENTIFIER discriminant_part IS formal_type_definition SEMICOLON ;; formal_complete_type_declaration
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  | TYPE IDENTIFIER IS formal_type_definition SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | TYPE IDENTIFIER discriminant_part IS TAGGED SEMICOLON ;; formal_incomplete_type_declaration
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  | TYPE IDENTIFIER discriminant_part SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  | TYPE IDENTIFIER SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'statement-end)
  ;

formal_type_definition
  : formal_private_type_definition
  | formal_derived_type_definition
  | LEFT_PAREN BOX RIGHT_PAREN ;; formal_discrete_type_definition
  | RANGE BOX ;; formal_signed_integer_type_definition
  | MOD BOX ;; formal_modular_type_definition
  | DIGITS BOX ;; formal_floating_point_definition
  | DELTA BOX ;; formal_ordinary_fixed_point_definition
  | DELTA BOX DIGITS BOX ;; formal_decimal_fixed_point_definition
  | array_type_definition ;; formal_array_type_definition
  | access_type_definition ;; formal_access_type_definition
  | interface_type_definition ;; formal_interface_type_definition
  ;

formal_derived_type_definition
  : ABSTRACT LIMITED NEW name AND interface_list WITH PRIVATE
  | ABSTRACT SYNCHRONIZED NEW name AND interface_list WITH PRIVATE
  | ABSTRACT LIMITED NEW name AND interface_list
  | ABSTRACT SYNCHRONIZED NEW name AND interface_list
  | ABSTRACT LIMITED NEW name WITH PRIVATE
  | ABSTRACT SYNCHRONIZED NEW name WITH PRIVATE
  | ABSTRACT NEW name
  | NEW name
  ;

;; leaving out [aspect_specification]
formal_package_declaration
  : WITH PACKAGE name IS NEW name formal_package_actual_part SEMICOLON
    (wisi-statement-action 1 'statement-start 8 'statement-end)
  ;

formal_package_actual_part
  : LEFT_PAREN BOX RIGHT_PAREN ;; (<>)
  | ;; null generic actual part
  | LEFT_PAREN association_list RIGHT_PAREN ;; covers others => <>
    (wisi-statement-action 1 'open-paren 3 'close-paren)
  ;

;; formal_package_association_list is merged into association_list to avoid reduce/reduce conflict

formal_private_type_definition
  : ABSTRACT TAGGED LIMITED PRIVATE
  | ABSTRACT TAGGED PRIVATE
  | PRIVATE
  | ABSTRACT PRIVATE
  ;

;; leaving out [aspect_specification]
full_type_declaration
  : TYPE IDENTIFIER discriminant_part IS type_definition SEMICOLON
  | TYPE IDENTIFIER IS type_definition SEMICOLON
  | task_type_declaration
  | protected_type_declaration
  ;

general_access_modifier : ALL | CONSTANT ;

;; generic_actual_part is not needed; see generic_instantiation

;; generic_association is merged into association

generic_declaration
  : generic_subprogram_declaration
  | generic_package_declaration
  ;

generic_formal_part
  : GENERIC generic_formal_parameter_declarations ;; leaving out use_clause
    (progn
      (wisi-statement-action 1 'block-start)
      (wisi-start-action 1 2))
  | GENERIC
    (wisi-statement-action 1 'block-start)
  ;

generic_formal_parameter_declarations
  : generic_formal_parameter_declaration
  | generic_formal_parameter_declarations generic_formal_parameter_declaration
  ;

generic_formal_parameter_declaration
  : formal_object_declaration
  | formal_type_declaration
  | formal_subprogram_declaration
  | formal_package_declaration
  | pragma
  ;

;; leaving out [aspect_specification]
generic_instantiation
 ;; 'name generic_actual_part' is included in 'name' as a function call
  : PACKAGE name IS NEW name SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'name 6 'statement-end)
  | overriding_indicator PROCEDURE name IS NEW name SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'name 7 'statement-end)
  | PROCEDURE name IS NEW name SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'name 6 'statement-end)
  | overriding_indicator FUNCTION name IS NEW name SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'name 7 'statement-end)
  | FUNCTION name IS NEW name SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'name 6 'statement-end)
  ;

generic_package_declaration
  : generic_formal_part package_specification SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 2 'block-middle 3 'statement-end)
      (wisi-start-action 1 2)
      (wisi-motion-action 1 2 3))
  ;

;; leaving out [aspect_specification]
generic_renaming_declaration
 ;; keyword following 'generic' is marked 'statement-other to support this indentation:
 ;;
 ;; generic
 ;; package foo renames
 ;;   bar;
 ;;
  : GENERIC PACKAGE name RENAMES name SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'statement-other 6 'statement-end)
  | GENERIC PROCEDURE name RENAMES name SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'statement-other 6 'statement-end)
  | GENERIC FUNCTION name RENAMES name SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'statement-other 6 'statement-end)
  ;

;; leaving out [aspect_specification]
generic_subprogram_declaration
  : generic_formal_part subprogram_specification SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 2 'block-middle 3 'statement-end)
      (wisi-start-action 1 2)
      (wisi-motion-action 1 2))
  ;

handled_sequence_of_statements
  : sequence_of_statements EXCEPTION exception_handler_list
  | sequence_of_statements
  ;

;; reduce/reduce conflict:
;; COMMA	reduce using rule 222 (identifier_list)
;; COMMA	[reduce using rule 262 (name)]
identifier_list
  : IDENTIFIER
  | identifier_list COMMA IDENTIFIER
  ;

if_expression
  : IF expression THEN expression elsif_expression_list ELSE expression
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 6 'block-middle)
      (wisi-start-action 1 5)
      (wisi-motion-action 1 3 5 6))
  | IF expression THEN expression elsif_expression_list
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle)
      (wisi-start-action 1 5)
      (wisi-motion-action 1 3 5))
  | IF expression THEN expression ELSE expression
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-middle)
      (wisi-motion-action 1 3 5))
  | IF expression THEN expression
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle)
      (wisi-motion-action 1 3))
  ;

if_statement
  : IF expression THEN sequence_of_statements elsif_statement_list ELSE sequence_of_statements END IF SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 6 'block-middle 8 'block-end 10 'statement-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 5)
      (wisi-start-action 1 7)
      (wisi-motion-action 1 3 5 6 7)) ;; FIXME: test navigate from ELSE to last elsif
  | IF expression THEN sequence_of_statements elsif_statement_list END IF SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 6 'block-end 9 'statement-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 5)
      (wisi-motion-action 1 3 5 6))
  | IF expression THEN sequence_of_statements ELSE sequence_of_statements END IF SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-middle 7 'block-end 9 'statement-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 5)
      (wisi-motion-action 1 3 5 7))
  | IF expression THEN sequence_of_statements END IF SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'block-end 7 'statement-end)
      (wisi-start-action 1 4)
      (wisi-motion-action 1 3 5))
  ;

index_subtype_definition : name RANGE BOX ;

index_subtype_definition_list
  : index_subtype_definition
  | index_subtype_definition_list COMMA index_subtype_definition
  ;

interface_list
  : name
  | interface_list AND name
  ;

interface_type_definition
  : LIMITED INTERFACE AND interface_list
  | TASK INTERFACE AND interface_list
  | PROTECTED INTERFACE AND interface_list
  | SYNCHRONIZED INTERFACE AND interface_list
  | LIMITED INTERFACE
  | TASK INTERFACE
  | PROTECTED INTERFACE
  | SYNCHRONIZED INTERFACE
  | INTERFACE
;

library_item
  : PRIVATE library_unit_declaration
  | library_unit_declaration
  | subprogram_body ;; library_unit_body
  | package_body ;; library_unit_body
 ;; | PRIVATE library_unit_renaming_declaration
  | library_unit_renaming_declaration
  ;

library_unit_declaration
  : subprogram_declaration
  | package_declaration
  | generic_declaration
  | generic_instantiation
  ;

library_unit_renaming_declaration
 ;; : package_renaming_declaration
  : generic_renaming_declaration
 ;; | subprogram_renaming_declaration
  ;

membership_choice_list
  : membership_choice
  | membership_choice_list BAR membership_choice
  ;

membership_choice
  : simple_expression
 ;; ARM has 'choice_expression' here, but that leads to a shift/reduce conflict, because of the following productions:
 ;; membership_choice_list => membership_choice => choice_expression => choice_relation_and_list
 ;; relation => simple_expression IN choice_relation_and_list
 ;; thus 'choice_relation_and_list AND' could be followed by relation (=> reduce) or choice_relation (=> shift)
 ;; This only occurs in legal Ada in expressions such as 'True in 1 and 3'; not useful, so we leave it out.
  | range
 ;;  | name ;; subtype_mark - also covered by simple__expression; avoid reduce/reduce conflict
  ;

mode
  :
  | IN
  | IN OUT
  | OUT
  ;

multiplying_operator : STAR | SLASH | MOD | REM ; ;; * | / | mod | rem

name_list
  : name
  | name_list COMMA name
  ;

name
  : IDENTIFIER
  ;; | CHARACTER_LITERAL
  ;; | explicit_dereference
  ;; | indexed_component
  ;; | slice
  | selected_component
  | attribute_reference
  ;; | type_conversion
  | name actual_parameter_part ;; function_call
  | qualified_expression
  ;; | generalized_reference
  ;; | generalized_indexing
  | STRING_LITERAL ;; operator_symbol, designator
  ;

;; null_exclusion replaced by 'not null'

;; leaving out [aspect_specification]
object_declaration
  : identifier_list COLON ALIASED CONSTANT name COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 8 'statement-end)
  | identifier_list COLON ALIASED CONSTANT name SEMICOLON
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  | identifier_list COLON ALIASED name COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 7 'statement-end)
  | identifier_list COLON ALIASED name SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | identifier_list COLON CONSTANT name COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 7 'statement-end)
  | identifier_list COLON CONSTANT name SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | identifier_list COLON name COLON_EQUAL expression SEMICOLON
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  | identifier_list COLON name SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  ;; | identifier_list COLON [ALIASED] [CONSTANT] access_definition [COLON_EQUAL expression] SEMICOLON
  ;; | identifier_list COLON [ALIASED] [CONSTANT] array_type_definition [COLON_EQUAL expression] SEMICOLON
  | single_task_declaration
  | single_protected_declaration
  ;

;; operator_symbol is STRING_LITERAL, in name

overriding_indicator
  : NOT OVERRIDING
  | OVERRIDING
  ;

;; leaving out [aspect_specification]
package_body
  : PACKAGE BODY name IS declarations BEGIN handled_sequence_of_statements END name SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 6 'block-middle 9 'block-end 10 'statement-end)
      (wisi-start-action 1 5)
      (wisi-start-action 1 7))
  | PACKAGE BODY name IS declarations BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 6 'block-middle 8 'block-end 9 'statement-end)
      (wisi-start-action 1 5)
      (wisi-start-action 1 7))
  | PACKAGE BODY name IS declarations END name SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 6 'block-end 8 'statement-end)
      (wisi-start-action 1 5))
  | PACKAGE BODY name IS declarations END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 6 'block-end 7 'statement-end)
      (wisi-start-action 1 5))
  | PACKAGE BODY name IS END SEMICOLON
    (wisi-statement-action 1 'block-start 4 'block-middle 5 'block-end 6 'statement-end)
  | PACKAGE BODY name IS END name SEMICOLON
    (wisi-statement-action 1 'block-start 4 'block-middle 5 'block-end 7 'statement-end)
  | PACKAGE BODY name IS BEGIN handled_sequence_of_statements END name SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 5 'block-middle 7 'block-end 9 'statement-end)
      (wisi-start-action 1 6))
  | PACKAGE BODY name IS BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 5 'block-middle 7 'block-end 8 'statement-end)
      (wisi-start-action 1 6))
  ;

;; leaving out  [aspect_specification]
package_body_stub
  : PACKAGE BODY name IS SEPARATE SEMICOLON
 ;; only 'identifier' allowed, but using 'name' eliminates a shift/reduce conflict
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  ;

package_declaration
  : package_specification SEMICOLON
    (progn
      (wisi-statement-action 1 'statement-start 2 'statement-end)
      (wisi-start-action 1 1))
  ;

;; leaving out [aspect_specification]
package_specification
  : PACKAGE name IS declarations PRIVATE declarations END name
    (progn
      (wisi-statement-action 1 'statement-start 2 'name 3 'block-start 5 'block-middle 7 'block-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 6))
  | PACKAGE name IS declarations END name
    (progn
      (wisi-statement-action 1 'statement-start 2 'name 3 'block-start 5 'block-end)
      (wisi-start-action 1 4))
  | PACKAGE name IS END name
 ;; there might be comments between 'is', 'end'.
    (wisi-statement-action 1 'statement-start 2 'name 3 'block-start 4 'block-end)
  ;

parameter_and_result_profile
  : formal_part RETURN NOT NULL name
    (wisi-statement-action
      2 'return-1;; for ada-indent-return
      5 'type);; for font-lock - see ada-wisi-setup
  | formal_part RETURN name
    (wisi-statement-action 2 'return-1 3 'type)
  | RETURN name
    (wisi-statement-action 1 'return-2 2 'type)
  | formal_part RETURN access_definition
    (wisi-statement-action 2 'return-1)
  | RETURN access_definition
    (wisi-statement-action 1 'return-2)
  ;

 ;; parameter_association is merged into association
 ;; parameter_association_list is merged into association_list

parameter_profile : | formal_part ;

parameter_specification
  : identifier_list COLON ALIASED mode NOT NULL name COLON_EQUAL expression
  | identifier_list COLON ALIASED mode NOT NULL name
  | identifier_list COLON ALIASED mode name
  | identifier_list COLON mode name
  | identifier_list COLON access_definition COLON_EQUAL expression
  | identifier_list COLON access_definition
  ;

parameter_specification_list
  : parameter_specification
  | parameter_specification_list SEMICOLON parameter_specification
    (wisi-statement-action 2 'list-break)
  ;

pragma
  : PRAGMA IDENTIFIER LEFT_PAREN pragma_argument_association_list RIGHT_PAREN SEMICOLON
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  | PRAGMA IDENTIFIER SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'statement-end)
  ;

pragma_argument_association
  : IDENTIFIER EQUAL_GREATER expression
  | expression
 ;; | IDENTIFIER TICK CLASS EQUAL_GREATER expression;; aspect_mark; causes shift/reduce conflict with attribute_reference
  ;

pragma_argument_association_list
  : pragma_argument_association
  | pragma_argument_association_list COMMA pragma_argument_association
  ;

;; prefix is name

primary
  : NUMERIC_LITERAL
  | NULL
 ;; | STRING_LITERAL in name
  | aggregate
  | name
  | NEW name ;; allocator, leaving out subpool_specification
  | LEFT_PAREN expression RIGHT_PAREN
  | LEFT_PAREN if_expression RIGHT_PAREN ;; conditional_expression
  | LEFT_PAREN case_expression RIGHT_PAREN ;; conditional_expression
  ;; | LEFT_PAREN quantified_expression RIGHT_PAREN
  ;

proper_body
  : subprogram_body
  | package_body
  ;; | task_body
  | protected_body
  ;

;; leaving out [aspect_specification]
protected_body
  : PROTECTED BODY IDENTIFIER IS protected_operation_item_list END IDENTIFIER SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 6 'block-end 8 'statement-end)
      (wisi-start-action 1 5))
  | PROTECTED BODY IDENTIFIER IS protected_operation_item_list END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 4 'block-middle 6 'block-end 7 'statement-end)
      (wisi-start-action 1 5))
  ;

;; leaving out [aspect_specification]
protected_body_stub
  : PROTECTED BODY IDENTIFIER IS SEPARATE SEMICOLON
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  ;

protected_operation_item
  : subprogram_declaration
  | subprogram_body
  ;; | entry_body
  ;; | aspect_clause
  ;

protected_operation_item_list
  : protected_operation_item
  | protected_operation_item_list protected_operation_item
  ;

protected_definition
  : declarations PRIVATE declarations END IDENTIFIER
    (wisi-statement-action 2 'block-middle 4 'block-end)
  | declarations PRIVATE declarations END
    (wisi-statement-action 2 'block-middle 4 'block-end)
  | declarations END
    (wisi-statement-action 2 'block-end)
  | END
    (wisi-statement-action 1 'block-end)
  ;

protected_type_declaration
 ;; leaving out [aspect_specification]
  : PROTECTED TYPE IDENTIFIER discriminant_part IS NEW interface_list WITH protected_definition SEMICOLON
    (wisi-statement-action 1 'statement-start 8 'block-start 10 'statement-end)
  | PROTECTED TYPE IDENTIFIER discriminant_part IS protected_definition SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'block-start 7 'statement-end)
  | PROTECTED TYPE IDENTIFIER IS protected_definition SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'block-start 6 'statement-end)
  ;

;; protected_operation_declaration merged into declaration

qualified_expression
  : name TICK aggregate
  ;

range
  : name TICK RANGE LEFT_PAREN expression RIGHT_PAREN ;; range_attribute_reference
  | name TICK RANGE ;; range_attribute_reference
  | simple_expression DOT_DOT simple_expression
  ;

real_range_specification : RANGE simple_expression DOT_DOT simple_expression ;

record_type_definition
  : ABSTRACT TAGGED LIMITED record_definition
  | ABSTRACT TAGGED record_definition
  | TAGGED record_definition
  | record_definition
  ;

record_definition
  : RECORD component_list END RECORD
  | NULL RECORD
  ;

relation_and_list
  : relation AND relation
  | relation_and_list AND relation
  ;

relation_and_then_list
  : relation AND THEN relation
  | relation_and_then_list AND THEN relation
  ;

relation_or_list
  : relation OR relation
  | relation_or_list OR relation
  ;

relation_or_else_list
  : relation OR ELSE relation
  | relation_or_else_list OR ELSE relation
  ;

relation_xor_list
  : relation XOR relation
  | relation_xor_list XOR relation
  ;

relation
  : simple_expression
  | simple_expression relational_operator simple_expression
  | simple_expression NOT IN membership_choice_list
  | simple_expression IN membership_choice_list
  ;

relational_operator
  : EQUAL | SLASH_EQUAL | LESS | LESS_EQUAL | GREATER | GREATER_EQUAL ;
  ;;  =   | /=          | <    |  <=        | >       | >=

renaming_declaration
  ;; : object_renaming_declaration
  ;; | exception_renaming_declaration
  ;; | package_renaming_declaration
  ;; | subprogram_renaming_declaration
  : generic_renaming_declaration
  ;

selected_component
  : name DOT IDENTIFIER
  | name DOT CHARACTER_LITERAL
  | name DOT STRING_LITERAL ;; operator_symbol
  ;

;; selector_name - IDENTIFIER, STRING_LITERAL overlap 'name'; CHARACTER_LITERAL used separately
;;  : IDENTIFIER | CHARACTER_LITERAL | STRING_LITERAL ; ;; operator_symbol

sequence_of_statements
  : statement ;; label is included in statement
  | sequence_of_statements statement
  ;

simple_expression
  : unary_adding_operator term_list
  | term_list
  ;

simple_return_statement
  : RETURN SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'statement-end)
  | RETURN expression SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'statement-end)
  ;

simple_statement
  : NULL SEMICOLON;; null_statement
    (wisi-statement-action 1 'statement-start 2 'statement-end)
  | assignment_statement
  ;; | exit_statement
  ;; | goto_statement
  | name SEMICOLON ;; procedure_call_statement; name includes function_call
  | simple_return_statement
  ;; | entry_call_statement
  ;; | requeue_statement
  ;; | delay_statement
  ;; | abort_statement
  ;; | raise_statement
  ;; | code_statement
  ;

;; leaving out [aspect_specification]
single_protected_declaration
  : PROTECTED IDENTIFIER IS NEW interface_list WITH protected_definition SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 6 'block-middle 8 'statement-end)
      (wisi-start-action 1 7))
  | PROTECTED IDENTIFIER IS protected_definition SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'statement-end)
      (wisi-start-action 1 4))
;

;; leaving out [aspect_specification]
single_task_declaration
  : TASK IDENTIFIER IS NEW interface_list WITH task_definition SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 6 'block-middle 8 'statement-end)
      (wisi-start-action 1 7))
  | TASK IDENTIFIER IS task_definition SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 3 'block-middle 5 'statement-end)
      (wisi-start-action 1 4))
  | TASK IDENTIFIER SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'statement-end)
  ;

;; ignoring list of labels on one statement
statement
;;  : label simple_statement
  : simple_statement ;; ignoring list of labels on one statement
  ;; | label compound_statement
  | compound_statement
  ;

;; leaving out [aspect_specification]
subprogram_body
  : overriding_indicator subprogram_specification IS declarations BEGIN handled_sequence_of_statements END
    name SEMICOLON
    (progn
      (wisi-statement-action 1 'statement-start 2 'block-start 3 'block-middle 5 'block-middle 7 'block-end 9 'statement-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 6))
  | overriding_indicator subprogram_specification IS declarations BEGIN handled_sequence_of_statements END
    SEMICOLON
    (progn
      (wisi-statement-action 1 'statement-start 2 'block-start 3 'block-middle 5 'block-middle 7 'block-end 8 'statement-end)
      (wisi-start-action 1 4)
      (wisi-start-action 1 6))
  | overriding_indicator subprogram_specification IS BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'statement-start 2'block-start 3 'block-middle 4 'block-middle 6 'block-end 7 'statement-end)
      (wisi-start-action 1 5))
  | subprogram_specification IS declarations BEGIN handled_sequence_of_statements END name SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 2 'block-middle 4 'block-middle 6 'block-end 8 'statement-end)
      (wisi-start-action 1 3)
      (wisi-start-action 1 5))
  | subprogram_specification IS declarations BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 2 'block-middle 4 'block-middle 6 'block-end 7 'statement-end)
      (wisi-start-action 1 3)
      (wisi-start-action 1 5))
  | subprogram_specification IS BEGIN handled_sequence_of_statements END name SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 2 'block-middle 3 'block-middle 5 'block-end 7 'statement-end)
      (wisi-start-action 1 4))
  | subprogram_specification IS BEGIN handled_sequence_of_statements END SEMICOLON
    (progn
      (wisi-statement-action 1 'block-start 2 'block-middle 3 'block-middle 5 'block-end 6 'statement-end)
      (wisi-start-action 1 4))
  ;

;; leaving out [aspect_specification]
subprogram_body_stub
  : overriding_indicator subprogram_specification IS SEPARATE SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | subprogram_specification IS SEPARATE SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  ;

subprogram_declaration
  : overriding_indicator subprogram_specification SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'block-middle 3 'statement-end)
  | subprogram_specification SEMICOLON
    (wisi-statement-action 1 'statement-start 2 'statement-end)
  ;

subprogram_default : name | BOX | NULL ;

subprogram_specification
  : PROCEDURE name parameter_profile ;; procedure_specification
    (wisi-statement-action 1 'statement-start 2 'name)
  | FUNCTION name parameter_and_result_profile ;; function_specification
    (wisi-statement-action 1 'statement-start 2 'name)
  ;

;; leaving out [aspect_specification]
subtype_declaration
  : SUBTYPE IDENTIFIER IS subtype_indication SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  ;

subtype_indication
  : NOT NULL name constraint
  | NOT NULL name
  | name constraint
  | name
  ;

;; subtype_mark replaced by name

;; leaving out [aspect_specification]
task_body_stub
  : TASK BODY IDENTIFIER IS SEPARATE SEMICOLON
    (wisi-statement-action 1 'statement-start 6 'statement-end)
  ;

task_definition
  : declarations PRIVATE declarations END IDENTIFIER
    (wisi-statement-action 2 'block-middle 4 'block-end)
  | declarations PRIVATE declarations END
    (wisi-statement-action 2 'block-middle 4 'block-end)
  | declarations END
    (wisi-statement-action 2 'block-end)
  | END
    (wisi-statement-action 1 'block-end)
  ;

;; task_item replaced by declaration

;; leaving out [aspect_specification]
task_type_declaration
  : TASK TYPE IDENTIFIER discriminant_part IS NEW interface_list WITH task_definition SEMICOLON
    (wisi-statement-action 1 'statement-start 10 'statement-end)
  | TASK TYPE IDENTIFIER discriminant_part IS task_definition SEMICOLON
    (wisi-statement-action 1 'statement-start 7 'statement-end)
  | TASK TYPE IDENTIFIER discriminant_part SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | TASK TYPE IDENTIFIER SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  ;

term
  : factor
  | term multiplying_operator factor
  ;

term_list
  : term
  | term_list binary_adding_operator term
  ;

type_declaration
  : full_type_declaration
  ;; | incomplete_type_declaration
  ;; | private_type_declaration
  ;; | private_extension_declaration
  ;

type_definition
  : enumeration_type_definition
  | RANGE RANGE simple_expression DOT_DOT simple_expression ;; integer_type_definition
  | MOD expression
  | DIGITS expression real_range_specification ;; real_type_definition
  | DIGITS expression ;; floating_point_type_definition
  | DELTA expression real_range_specification ;; ordinary_fixed_point_definition
  | DELTA expression DIGITS expression real_range_specification ;; decimal_fixed_point_definition
  | array_type_definition
  | record_type_definition
  | access_type_definition
  | derived_type_definition
  | interface_type_definition
  ;

variant_part
  : CASE name IS variant_list END CASE SEMICOLON
  ;

variant_list
  : variant
  | variant_list variant
  ;

variant : WHEN discrete_choice_list EQUAL_GREATER component_list ;

unary_adding_operator : PLUS | MINUS ; ;; + | -

use_clause
  : USE name_list SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'statement-end)
  | USE ALL TYPE name_list SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | USE TYPE name_list SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  ;

with_clause
  : LIMITED PRIVATE WITH name_list SEMICOLON
    (wisi-statement-action 1 'statement-start 5 'statement-end)
  | LIMITED WITH name_list SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  | PRIVATE WITH name_list SEMICOLON
    (wisi-statement-action 1 'statement-start 4 'statement-end)
  | WITH name_list SEMICOLON
    (wisi-statement-action 1 'statement-start 3 'statement-end)
  ;

%%

;; Local Variables:
;; eval: (add-hook 'before-save-hook 'delete-trailing-whitespace nil t)
;; End:
;;; end of file
